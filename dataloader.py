import torch
import torch.nn
from torch.utils.data import Dataset, DataLoader

import random
import pandas as pd

from tokenization import TOKENIZER, BERT_MODEL, create_out_tensor
from torch.nn.utils.rnn import pad_sequence, pack_padded_sequence

#create a directory where the key is a csv. each row has first column as the raw text sentence, and the second col being the 
# path to the file that stores all its lambda terms

DATA_PATH = "/home/mishaalk/projects/def-gpenn/mishaalk/lambdaBERT/data/"
BOS_TOKEN_LAST = [[[ 6.6404e-03,  1.2032e-01, -2.5759e-02,  1.1922e-01,  1.6584e-01,
        -2.4184e-02,  4.3246e-02, -9.4100e-02,  4.8467e-02,  1.7669e-01,
        -7.7217e-02, -2.4837e-02, -1.4056e-01,  1.7926e-01, -6.4828e-01,
        -7.3258e-02, -8.9447e-02,  2.1371e-01, -1.2161e-01,  1.0244e-01,
         6.7791e-02,  1.8859e-01, -1.0735e-01,  2.3882e-02,  1.5444e-01,
        -2.6282e-01, -3.3250e-02,  1.8822e-01,  5.5780e-01, -1.7566e-02,
        -7.6625e-02,  1.0362e-01,  5.8048e-02,  8.4992e-02,  1.2117e-03,
        -1.0043e-01, -2.1721e+00, -1.9985e-01, -5.1504e-02, -6.7338e-02,
        -2.0674e-01, -2.3005e-01, -1.5397e-01,  9.5332e-02, -6.3512e-02,
         1.2807e+00,  1.4178e-02, -1.8576e-02,  1.4823e+00,  1.9270e-02,
        -5.9236e-02, -6.0212e-01, -1.7453e-01, -1.7044e+00,  1.2499e-01,
         1.6056e-02, -1.6070e-01, -1.1272e-02,  1.0654e-03, -7.7694e-02,
         5.3773e-02,  1.3326e-01,  6.9327e-02,  6.1773e-02, -5.9913e-02,
        -3.5054e-02, -2.8590e-03,  1.0260e-01, -1.1419e-01,  9.9777e-02,
         5.9105e-03,  1.9589e-01,  1.2293e-01, -1.5506e-01, -7.6429e-02,
        -1.4282e-01, -1.7914e-05, -1.2305e-01, -2.4040e-01,  2.9151e-01,
         4.7447e-02,  1.5829e-02, -2.6662e-01,  2.8324e-02,  1.0781e-01,
         5.4945e-03,  5.4840e-02,  8.6916e-02, -5.8118e-02,  2.7340e-02,
        -2.0572e-01,  2.8052e-02, -6.7356e-01, -3.1306e-02, -1.0893e-01,
        -1.0694e+00, -5.9890e-02,  2.6134e-02,  7.2604e-03, -2.3117e-02,
        -1.6316e-01,  1.7106e+00,  1.1605e-01, -1.8618e-05, -3.6524e+00,
        -9.5988e-03, -7.3412e-02, -6.1941e-02,  6.3637e-01, -2.3176e-01,
         1.3035e-01, -1.1704e-01,  9.5213e-03,  1.5106e-01,  8.9788e-03,
         2.0076e-01, -4.0258e-02, -4.9685e-02, -4.6654e-01, -2.7422e-02,
        -6.3353e-02, -7.3232e-02,  5.9283e-02, -2.2592e-01, -4.7307e-02,
        -5.2467e-03,  1.0445e-01,  2.8276e-02,  2.5251e-01,  9.7282e-01,
        -2.2082e-02,  2.3929e+00,  2.6319e-04, -3.5717e-03,  2.0193e-01,
         1.7448e+00,  4.5816e-02, -1.0780e-02,  2.1197e-01,  1.2408e-01,
         1.3288e-01, -1.0827e-01, -1.1218e-01, -2.3250e-02, -9.2024e-02,
         5.3779e-02, -2.2214e-02, -1.4284e-01,  1.2346e-01,  1.0770e-01,
         5.4780e-02, -1.7422e-01, -2.0349e-02,  5.8825e-02, -1.7184e-01,
         1.5653e-02, -3.4945e-02, -2.2705e-02, -6.5233e-02,  4.8596e-02,
         1.7105e+00,  8.5189e-02, -1.3195e-01,  4.2991e-02,  8.2198e-02,
        -4.3037e-02, -2.6830e-02, -4.7440e-03, -1.2000e-01, -3.0421e-01,
        -3.3308e-01, -1.0420e-01,  2.8626e-01,  5.3635e-02,  1.2777e-01,
        -9.4403e-02, -1.4837e-01, -9.6198e-02, -8.4007e-02, -1.2597e-01,
        -5.8390e-02,  1.4807e-01,  5.3084e-02,  3.1327e-02,  3.0485e-02,
         8.6029e-02,  1.4436e-01,  2.2128e-01, -1.3477e-01,  7.0721e-02,
         2.1772e-01,  4.0437e-02, -2.0393e-02, -2.2766e-01,  1.0553e-01,
        -3.3788e-02,  4.4788e-02,  3.0608e-02, -2.6779e-02, -4.8689e-02,
         3.3862e-01,  8.6382e-02,  2.4781e-02,  5.8742e-02,  5.9055e-02,
         1.1162e-01,  6.5087e-02, -7.8434e-02,  1.4590e-03,  8.2074e-02,
        -9.4245e-02, -1.5601e-01,  1.1691e+00,  9.7153e-02,  3.3933e-02,
        -1.1589e-01, -9.5559e-02,  1.7733e-02,  1.0448e-01, -2.5085e+00,
        -2.3421e-02, -1.6931e-02, -5.3320e-02, -1.1517e-01,  6.2452e-02,
         1.6010e-01, -1.3819e-01,  6.1344e-01,  8.5391e-02,  1.5618e-01,
         1.1019e-01,  8.8110e-02,  1.2693e-01, -2.1870e+00,  8.8819e-03,
        -5.1132e-02, -8.8723e-02, -1.5821e-01, -6.7047e-02,  4.2471e-02,
        -3.1035e-02,  6.4917e-02,  2.8246e-02, -5.6321e-02,  1.6853e-01,
        -3.1344e-01,  1.3757e+00, -1.2073e-01, -2.2535e-02, -4.4942e-01,
        -1.5976e-02,  3.0034e-02,  4.8985e-01,  2.4515e-01,  5.8742e-02,
         6.4414e-02, -3.8082e-02,  4.5259e-02,  1.2806e-01, -2.4751e-02,
        -1.0223e-01, -1.8068e-01,  8.4525e-02, -6.5758e-01, -4.1394e-02,
         6.1814e-02, -1.0397e-01,  4.8240e-02,  2.3873e-02, -1.2707e-01,
        -1.1200e-01,  3.7888e-02, -4.9887e-02, -1.0088e-01, -4.0052e-02,
         7.6017e-02,  2.0746e-02, -5.0495e-02, -1.1080e-02, -1.3467e-02,
        -2.0572e-01,  2.5585e-02,  1.1952e-01,  9.4298e-02,  8.2876e-02,
         8.1770e-02, -5.4902e-02, -3.0516e-02, -6.5531e-01, -1.0441e+00,
        -6.6959e-02,  1.6825e-01,  4.9694e-02, -3.5986e-01, -1.0470e-01,
        -2.2429e-01, -1.1062e-01,  1.1991e-02,  1.2031e-01,  5.8477e-02,
        -8.6005e-02, -2.5338e-01,  1.3587e-01, -9.2579e-03, -1.7431e+00,
         8.5922e-02, -9.5785e-02,  4.3104e-02, -1.2186e-01,  9.5103e-02,
         2.0545e-02,  9.5109e-02,  1.1924e-02,  4.9723e-02, -1.5280e-01,
        -9.3718e-02, -7.1413e-02,  1.2157e-01,  2.0021e-01,  3.2024e-02,
        -6.9632e-02, -2.2226e+00, -3.1290e-03, -1.5316e-01,  1.0647e-01,
        -9.7621e-02, -7.2991e-02,  1.5398e-01,  3.3926e-02,  2.8123e-01,
        -5.0940e-02,  2.5797e-01,  1.0861e-01, -9.3777e-02, -8.5790e-02,
        -5.2077e-02,  5.3976e-03, -5.2809e-02,  1.0356e-01, -7.3009e-02,
        -6.0342e-02, -1.5251e-04, -1.8585e-01, -9.2457e-02,  1.1204e-01,
         3.1675e-02, -8.8677e-02, -7.2117e-02,  2.5055e-02,  7.2432e-02,
         5.1389e-02,  4.8985e-02, -7.6624e-01,  6.0720e-02,  2.4855e-02,
        -1.7630e-01,  5.2601e-02,  2.4004e-02, -1.4469e-01,  2.4997e-01,
        -1.9767e-01,  3.9444e-02,  3.0555e-01, -1.2006e-01,  1.9596e-01,
         2.6230e-03,  6.5686e-02,  2.8841e-01,  1.9166e-01, -9.8390e-03,
        -1.5442e-02, -1.3985e-01, -1.6738e-01, -2.5462e-01, -7.1632e-02,
         3.5983e-03,  4.5189e-02,  1.2372e-04, -3.5195e-03, -5.0004e-02,
        -6.7909e-02, -1.9748e-02, -1.4385e+00,  1.7377e-01,  3.4760e-01,
        -1.7810e+00,  1.0534e-01,  6.1746e-02,  3.5921e-02, -1.5548e-01,
        -3.6626e-02,  1.9688e-01, -1.7472e-02, -3.0340e-02, -4.1146e-02,
        -5.2586e-03, -4.9970e-02, -2.8653e-02,  1.6324e-01,  5.0090e-03,
         1.7314e-01, -1.0167e-01, -2.4512e-02, -7.2739e-03, -2.8049e-02,
        -2.0184e+00,  1.0197e-01, -1.5852e-02, -4.9756e-02,  2.7873e-02,
        -5.3640e-02, -1.0799e-01, -1.1636e-01, -1.6722e-01, -1.3057e-01,
         9.7360e-02, -2.3237e-01, -9.3868e-03, -1.4465e-02, -5.9721e-01,
        -4.2152e-02,  5.9725e-01, -5.3585e-02, -2.9379e-01, -1.5868e-01,
         8.8038e-03,  5.1881e-02, -6.2811e-02, -4.8510e-02,  1.5877e-01,
        -7.2605e-02,  1.4552e-02,  6.4635e-02, -1.4743e+00, -2.2017e+00,
         1.2610e+00,  1.7708e-02,  7.2417e-02,  6.9095e-02,  2.2660e+00,
        -1.0380e-01, -4.1963e-03, -4.2452e-02,  2.1331e-02,  2.4740e-01,
         3.1763e+00,  2.4001e-01,  6.4580e-02,  1.8380e+00,  2.5057e-02,
         3.5223e-02, -1.4498e-01, -2.0354e+00, -2.1454e+00, -1.4762e-01,
        -5.3366e-02,  3.6151e-02, -7.2954e-02,  2.2417e-01,  1.2775e-01,
         2.1348e-01, -9.8801e-02,  8.3391e-03,  1.1059e-01,  1.8043e-01,
         2.4679e-02,  2.6775e-02, -8.3967e-02,  1.5967e-02, -2.0757e-01,
         9.4811e-01,  9.1757e-02, -1.2894e-03,  5.5877e-02,  1.0400e-01,
        -2.4096e+00,  3.9807e-02, -7.9669e-02, -7.8097e-02, -1.6113e-01,
         4.7261e-02,  3.2618e-02,  9.3380e-03, -7.9485e-02,  4.8009e-02,
         5.9944e-02, -5.4698e-02,  1.2625e-02,  4.2590e-02,  7.0202e-02,
         4.3080e-02, -7.4990e-02,  1.1469e-01,  2.5989e+00,  9.4673e-02,
        -3.8534e-04, -9.8185e-02, -3.1461e-02,  4.5825e-02, -8.3487e-02,
         3.6759e-02, -2.8784e-01,  1.0266e-02,  1.1807e-01, -5.3656e-02,
         1.8057e-01, -2.3706e-01, -1.0281e-02,  2.4880e-02,  7.2451e-02,
         7.1043e-01,  4.5347e-01, -1.9976e-01, -1.0058e+00,  4.2826e-02,
        -1.8480e-01,  2.3376e-02, -1.7980e-01,  7.8068e-02,  1.5959e-02,
         2.9831e-02, -4.2507e-02, -1.5723e-01, -1.3801e-02,  9.1634e-02,
         3.5534e-02, -2.3941e-01,  7.8092e-02, -2.4483e-02, -6.6363e-02,
        -1.4145e-01, -8.0066e-01, -2.7703e-02,  1.7006e+00, -6.1152e-02,
         1.5464e-01,  1.4185e+00, -4.0334e-03, -3.2187e-02,  4.4652e-02,
         1.3116e-01,  4.5793e-02,  1.1641e-01, -1.2981e-01,  2.2019e-02,
         1.5713e-01,  2.3314e-01, -2.8483e-01,  6.1031e-02,  6.4343e-02,
        -2.2052e-03,  6.3898e-02, -5.1379e-03, -4.4587e-02,  5.0012e-02,
        -4.2697e-01, -2.0679e-01, -7.3452e-02, -7.0396e-02, -6.6046e-02,
         1.5468e-01,  1.3345e-01, -1.6760e-03,  1.0927e-01, -1.3803e-01,
         6.4195e-02,  9.8776e-02, -5.8833e-02,  7.7106e-02,  4.6967e-02,
         4.8545e-02, -5.2564e-02, -1.6171e-03,  7.9853e-03, -9.8726e-03,
         8.8846e-02,  5.1999e-02,  5.3051e-01,  2.0186e-01, -2.1112e-02,
         4.8219e-02,  6.4145e-02, -3.2437e-02,  1.0086e-01, -6.9256e-01,
        -1.0334e-02,  1.9437e-01,  1.1038e-01,  6.6385e-02,  1.8702e-03,
         9.1617e-02, -2.3387e-02,  8.0812e-02, -2.9190e-02, -4.8537e-02,
         3.5404e-02,  2.2891e-02,  9.0513e-02,  1.4223e-01, -8.3754e-02,
        -4.4187e-02, -5.0614e-02,  1.5077e-01,  1.2289e-01,  8.4590e-02,
        -6.5143e-02,  3.6676e-02, -1.1077e-01, -8.4955e-02,  3.1744e-02,
         7.4333e-02,  1.1234e-01,  5.9904e-02,  7.6625e-02,  1.4405e-01,
        -2.3107e+00,  1.7304e-01,  3.3054e-02,  9.5538e-02, -1.2232e-02,
         6.9733e-02,  9.0535e-01,  1.2111e-01, -9.4070e-02, -1.2960e-01,
        -1.0575e-01, -4.3360e-02,  8.4753e-03, -9.5387e-02, -5.1091e-01,
         1.9301e-01,  1.0097e-01, -3.2541e-02, -1.6688e-01,  7.8831e-02,
        -1.9387e+00, -5.0339e-02, -4.7176e-02, -1.3069e-02,  1.1166e-01,
        -1.1994e-01, -1.8251e-01, -1.9879e-01, -1.2519e-01,  3.5296e-02,
         2.9218e-02,  1.0093e-01,  6.6782e-02,  1.1283e-01,  2.5980e-01,
         1.4733e-01, -8.8303e-02, -1.2637e-01, -1.6570e-01, -3.2048e-03,
        -5.3973e-02, -1.1058e-03, -6.5014e-02,  1.0134e-01,  3.6315e-01,
         1.9188e-01,  7.3621e-02,  9.7970e-02, -1.7061e-01,  7.6595e-02,
        -1.9698e+00,  1.6156e-01,  1.3498e-01, -5.1356e-02,  1.8370e-01,
         1.9283e-01,  2.2650e-01, -2.4405e-01, -1.5121e-01, -9.4120e-02,
        -3.8034e-01,  5.1120e-02, -5.9038e-03,  1.3757e-01, -8.9426e-02,
         1.2296e-01,  5.2396e-02, -4.7319e-02, -2.8727e-01, -3.7198e-02,
         1.2336e-01, -2.0108e-01,  4.4096e-01, -1.2265e-01,  1.2067e-01,
         2.3588e-01, -5.7588e-02,  2.0643e-02, -6.3073e-02,  3.4049e-02,
        -5.6848e-02, -1.1538e+00, -2.3030e-02,  5.5618e-02,  2.6230e-02,
        -9.6303e-02,  3.2983e-02,  1.9520e-01,  9.8491e-02,  4.3118e-01,
         8.9849e-02,  3.9251e-01,  2.2434e+00,  1.7304e-01, -4.5162e-02,
        -1.2948e-02,  6.1528e-02, -7.1943e-02,  1.3040e-01, -1.0841e-01,
         2.2716e+00, -1.7201e-02,  1.3838e-01,  1.2986e-01, -3.0358e-03,
         1.3685e-01,  1.8405e+00, -8.8316e-03, -2.4744e-02,  2.7197e-01,
         5.9175e-02,  1.1824e-01, -7.9167e-04, -1.6355e-01,  1.2502e-01,
        -2.9221e-03, -6.2029e-01,  2.1830e-02,  9.5445e-02,  8.7118e-02,
         7.1465e-02, -7.4021e-01,  3.1005e-02, -7.6716e-02,  2.5937e-02,
         2.0865e-02,  2.9383e-01, -3.9137e-02, -1.3635e-01,  7.7467e-02,
         7.0308e-02, -3.3533e-02,  1.6234e-01, -1.1016e-02,  1.8590e-02,
         5.8357e-02,  4.4114e-02,  4.9539e-01, -1.0547e-01, -3.4688e-03,
         6.3189e-01,  1.8792e-01, -2.5112e-02, -1.6605e-02, -2.3493e-01,
         2.3296e-02, -6.7086e-02, -5.0288e-02,  1.8227e-01,  1.5343e-01,
         4.4159e-02,  4.9449e-02, -1.0970e-01]]]
BOS_TOKEN = [[[ 4.5813e-01,  3.3062e+00,  2.1096e-01,  3.0148e-01,  3.0300e+00,
        -5.4060e-01, -1.4473e+00, -7.7376e-01,  1.1557e+00,  8.1681e-01,
         3.8579e-01, -7.3953e-01, -1.4743e+00,  9.7946e-01, -1.1893e+00,
        -1.6349e+00,  2.4361e+00,  6.9082e-01, -5.8635e-01, -1.7694e-01,
        -2.5312e-01,  1.0762e+00, -2.7269e+00, -2.6902e-01,  1.6194e-01,
        -1.5149e+00,  3.7506e-02, -1.3511e-02,  4.3024e+00, -1.6607e+00,
        -1.1281e+00,  8.2105e-01,  2.5557e+00, -1.9959e-01,  7.4464e-01,
        -2.6752e-02, -7.8344e+00, -1.1126e+00,  1.3413e+00,  3.8977e-01,
        -2.7951e+00, -1.0670e+00, -1.4736e+00, -3.6161e-01, -1.2628e+00,
         3.9127e+00, -1.7596e+00, -6.6815e-01,  6.9363e+00, -2.6115e+00,
         2.0802e+00, -1.5206e+00, -1.9134e+00, -2.1839e+00,  3.0526e+00,
        -2.8766e-01, -5.1018e+00, -9.8654e-01, -1.8078e-01, -1.0675e+00,
         6.3234e-01,  1.2454e+00,  3.6524e-02, -1.8394e+00, -2.2160e+00,
        -1.4736e+00,  4.3474e-01,  1.1521e+00,  1.7012e-01, -1.4835e+00,
        -2.8626e-01,  3.8348e+00,  1.2041e+00, -5.6297e-01, -1.6019e+00,
        -5.6392e-01, -2.0604e+00, -7.7617e-01, -1.7242e+00,  4.6957e+00,
         1.9253e+00, -1.3246e-01,  8.2692e-01, -2.6253e+00,  2.9248e+00,
         1.3868e+00,  4.5622e-01,  1.2058e+00, -1.4783e+00,  6.6499e-01,
        -1.0458e+00, -5.6293e-01, -1.2461e+00, -7.4462e-01, -6.2908e-01,
        -4.6896e-01,  3.2049e+00,  9.3912e-02,  2.4491e+00, -6.8828e-01,
        -2.4595e+00,  2.7713e+00, -2.8448e+00, -1.0130e+00, -6.6361e+00,
        -1.4661e+00,  2.8524e-01, -5.6380e-01,  3.1775e+00, -1.8077e+00,
         1.0504e+00, -3.6907e-01,  1.7233e+00, -1.9238e+00, -3.4914e+00,
         1.8666e+00, -1.2942e+00, -7.1870e-01, -3.7948e+00, -1.1451e+00,
        -2.7479e+00, -7.7096e-01,  8.6750e-01,  1.8707e-01, -7.5984e-01,
         1.5096e+00, -3.8576e-01,  2.0047e+00, -2.6595e-01,  3.3407e+00,
         9.7580e-01,  4.2681e+00, -1.1986e+00, -2.1378e+00, -3.3698e-01,
         2.6683e+00,  1.1676e+00, -7.8479e-01,  3.0311e-01,  4.3569e-01,
         2.5422e+00, -2.3546e+00, -4.7282e-01, -3.3731e+00, -3.4666e+00,
         1.0775e+00,  6.4715e-01, -1.4388e+00,  1.0884e+00, -5.1324e-01,
         1.2714e+00, -1.2294e+00,  1.0870e+00, -1.1076e+00, -2.0587e-01,
         2.2967e+00, -2.8420e+00, -1.2279e-01, -3.8884e+00,  1.5857e+00,
         4.6744e+00, -3.1737e-01,  1.5134e+00, -5.4028e-01,  9.1508e-01,
        -9.6851e-01,  1.9061e-01, -1.2022e+00, -6.9874e-01, -7.2548e-01,
        -1.3181e+00, -1.4226e+00,  5.1605e-01, -1.9263e-01,  1.6194e+00,
        -2.3345e-01, -3.4187e+00, -1.7106e+00, -1.3953e+00, -2.3031e+00,
         4.7282e-01, -8.0191e-01,  1.0266e+00, -4.1843e-01,  4.8150e-01,
         2.6445e+00, -6.3551e-01,  2.6124e+00, -1.1149e+00,  1.6585e+00,
         1.3559e+00, -1.8666e+00,  2.1065e-01, -1.6904e+00,  1.4659e+00,
        -2.2391e+00,  5.9651e-01, -1.0365e-02, -1.1154e+00, -1.7697e-01,
        -2.0980e+00,  1.4635e+00, -1.5461e-01,  6.0338e-01, -2.3296e+00,
         3.2311e-01, -3.2930e-01, -2.1656e+00, -8.1404e-01,  5.9486e-01,
        -9.2714e-01, -1.6340e+00,  2.6905e+00,  2.2357e+00,  8.8828e-01,
        -2.0993e+00,  5.8983e-01, -3.2140e-01,  1.0384e+00, -3.1049e+00,
        -1.7879e+00, -6.0728e-03,  3.8398e-01, -3.9065e-01,  1.0254e+00,
         1.3860e+00, -6.2315e-01, -8.7506e+01,  2.8931e+00,  2.0169e+00,
         5.6510e-01,  1.3562e+00,  1.5053e+00, -3.7152e+00, -1.2615e-01,
        -1.1027e+00, -4.7194e-01, -1.7665e+00,  1.4869e-01, -1.0512e+00,
         1.3842e+00,  1.7856e+00,  1.1795e+00, -8.8518e-01, -3.5921e-01,
        -1.4274e+00,  1.9481e+00, -1.4083e+00, -1.6653e+00, -5.0580e+00,
        -5.2213e-01,  3.2314e+00,  4.4102e+00,  1.6658e+00, -2.8984e-01,
         2.1602e+00,  3.4525e-02, -8.7899e-01,  7.4631e-01, -3.1525e-01,
        -1.3327e+00, -8.4851e-01, -4.2144e-01,  4.6263e-01,  1.9734e-01,
         1.7164e+00, -8.2830e-01, -1.5690e-01, -6.5551e-01, -5.0869e-01,
         8.2753e-01, -5.1484e-01, -1.1299e+00,  6.1700e-01, -5.5363e-01,
        -9.4740e-01,  9.9478e-01, -1.1108e-01, -1.1960e+00, -8.0977e-01,
        -2.4399e+00, -5.7600e-01,  3.0635e-01, -2.0306e+00, -1.3583e+00,
         1.7122e+00, -2.2545e-01,  1.1888e+00, -1.2449e+00, -1.6284e+00,
         9.0867e-02,  2.3823e+00, -2.5367e-01, -3.2870e+00, -1.5886e+00,
        -4.7831e-01, -5.3905e-01,  3.0963e-01, -3.7800e-01, -1.8543e+00,
        -3.1581e-01, -1.5805e+00, -1.3910e+00,  7.0966e-01, -3.8356e+00,
         4.4476e-01, -1.7609e+00, -2.3366e-01,  2.7023e-01,  1.9924e-01,
         3.6185e-02,  1.5386e+00,  1.5739e+00,  5.2804e-01, -1.8977e-01,
        -3.3582e+00, -1.2909e+00,  2.1713e+00,  1.4080e+00, -2.2389e+00,
         2.4506e-01, -3.9391e+00, -9.1647e-01, -4.4443e-01,  1.0924e+00,
        -1.4942e+00, -1.6122e+00,  6.5330e-01,  1.0600e+00, -7.4473e-01,
        -5.7946e-01,  3.0508e+00, -5.5302e-01, -1.4866e+00,  1.3876e+00,
        -4.6643e-01,  1.0086e+00, -3.7007e-01, -4.6215e-01, -5.9812e-01,
         3.0514e-01,  7.9396e-01, -4.5880e+00, -1.4843e+00,  2.7339e-01,
        -6.3179e-01, -1.3027e+00, -2.5287e-02, -7.1941e-02,  5.4024e-02,
         1.2276e+00, -8.5036e-02, -1.5196e+00, -8.9325e-01, -7.1474e-02,
        -8.1940e-03, -5.2687e-01, -7.1358e-01, -2.9127e+00,  1.8146e+00,
        -1.8303e+00, -1.4636e+00,  1.1615e+00, -1.0415e+00,  1.0447e+00,
         5.4190e-01,  1.1797e+00,  3.7680e-01,  1.3246e+00,  5.3493e-01,
        -6.8673e-01, -1.0951e+00, -1.2757e-01, -8.4997e-01, -8.0226e-01,
         1.7689e+00,  5.6463e-01, -1.5136e-01, -3.8292e-01, -1.2120e+00,
        -2.7505e+00, -2.1423e+00, -3.8724e+00,  2.8202e+00, -2.1037e-01,
        -3.6741e+00,  1.6732e+00,  3.8627e-01, -1.0090e+00, -1.4851e+00,
         1.2353e+00,  4.1024e+00, -1.7232e+00, -2.0919e+00, -2.3260e+00,
         2.8746e+00, -9.6691e-01,  6.2085e-01,  1.8997e+00, -2.9498e+00,
         1.3006e+00, -1.1838e+00, -1.5752e+00, -3.8206e-01, -6.6988e-01,
        -4.5461e+00, -8.0805e-01, -1.4779e+00,  1.7823e-02, -7.6897e-01,
        -1.4646e+00,  2.1866e+00, -3.5271e-01, -3.8074e+00, -4.6498e-02,
         1.0871e+00, -1.4462e+00,  2.0663e+00, -6.9344e-02, -1.7909e+00,
        -1.4029e+00, -1.9184e+00, -1.6364e+00,  3.7441e+00, -1.4766e+00,
         1.1618e+00,  1.0485e+00, -3.4423e+00,  9.4450e-01,  7.4766e-01,
        -7.1510e-01,  9.9576e-01,  9.9661e-01, -2.4232e+00, -5.5297e+00,
         1.5172e+00,  2.1695e-01,  2.0433e+00,  1.2454e+00,  5.0609e+00,
        -1.0600e+00, -3.5157e+00, -2.4880e+00,  9.0986e-01,  4.9923e-01,
         1.7303e+01, -1.9426e+00,  2.2812e+00,  2.5834e+00,  1.3091e+00,
        -7.6591e-01,  2.9553e+00, -4.3232e+00, -2.8205e+00, -1.4021e+00,
        -4.2503e-01, -1.5225e+00, -5.9332e-01,  6.2550e-01,  3.0785e+00,
         1.3403e+00, -2.3408e+00,  2.5845e-02,  2.2223e+00,  2.1375e+00,
        -3.4470e-01,  2.3260e+00,  3.6481e-01, -3.8108e-02, -1.4996e+00,
         4.2520e-01, -1.2790e+00,  1.4820e-01, -8.0800e-01, -7.5909e-01,
        -2.5480e+00, -8.7266e-01,  8.3442e-01, -1.5422e+00, -1.3096e+00,
         9.8009e-01, -3.3744e-01,  9.4865e-01, -5.7665e-01,  7.0491e-01,
         1.4868e+00, -1.7920e+00,  7.9264e-01,  9.0948e-01,  9.6189e-02,
         1.2376e+00, -7.8595e-01,  2.0809e+00,  4.9537e+00,  4.8233e-01,
         2.6005e+00, -3.2921e+00,  3.3903e-01,  2.0479e-01, -7.8714e-01,
        -3.2811e-01,  1.4476e+00,  8.5103e-01,  3.2563e+00, -3.3427e-01,
         8.4822e-01, -4.0252e+00, -6.6117e-01, -1.3867e+00,  8.0298e-01,
        -1.3732e+00,  6.2034e+00, -1.4417e+00, -2.7159e-01,  5.0743e-02,
        -3.7124e+00,  4.1055e-02, -2.2289e+00, -5.3361e-02,  8.4058e-01,
        -7.8842e-01, -7.4454e-01,  9.1276e-01,  4.8950e-02,  1.4652e+00,
         1.0877e+00, -3.4050e+00,  1.7755e+00,  1.2556e+00,  7.2009e-01,
        -2.5973e+00, -2.1333e+00, -6.9588e-01,  3.8844e+00, -8.9259e-01,
         1.1609e-01,  2.5610e+00,  1.6357e+00, -2.9194e+00, -1.6337e+00,
         6.8473e-01,  6.1380e-01,  8.1834e-01,  4.3551e-01, -5.6138e-01,
         2.8779e-01,  3.4333e-01, -5.4653e-01,  2.7325e-01, -8.9123e-01,
        -7.5517e-01, -8.4797e-01,  5.5130e-01, -1.2731e+00,  2.0659e+00,
        -7.3876e-01, -8.2850e-01,  2.9595e+00, -1.6677e+00, -2.2481e-01,
         2.8158e+00,  2.7244e+00,  6.2724e-01,  7.0332e-01,  1.2331e-01,
         3.7354e-03, -1.2949e+00,  2.8314e-01,  1.7200e-01,  9.1297e-01,
         5.8721e-01, -1.5384e+00,  1.0339e+00,  1.0356e+00, -5.4380e-01,
        -7.3531e-02,  3.4066e-01,  9.0423e-02,  2.6214e-01, -3.2918e-01,
        -5.6148e-01,  8.5937e-02, -6.5549e-01,  7.2560e-01, -2.0573e+00,
         1.9709e-01,  3.7429e-01,  1.9596e-01, -7.5774e-01,  5.6090e-01,
         1.6633e+00,  1.6986e+00,  1.3323e+00, -2.5264e+00, -2.1438e+00,
        -2.8640e-02, -5.0611e-01, -5.4155e-01,  2.2533e+00, -1.1911e+00,
         7.8980e-01, -1.5024e+00,  4.0583e-01,  2.3183e+00,  1.0114e+00,
        -9.5003e-01, -2.9533e-02,  1.3287e-01, -1.2694e-01,  2.7643e+00,
        -5.6814e-01,  1.6729e+00, -3.4178e-01,  2.0075e+00,  3.7113e+00,
        -3.1745e+00,  2.9330e-01,  1.7969e+00,  6.8635e-01, -1.4360e+00,
        -6.2537e-01,  2.1255e+00,  2.0219e+00, -5.5194e-01, -8.5038e-01,
         7.6672e-01, -1.9228e+00,  6.7525e-01, -6.8469e-01, -2.7454e+00,
         1.3258e+00, -1.0835e+00, -2.7379e+00, -1.1933e+00,  1.6702e+00,
        -4.0056e+00, -7.5293e-01,  1.6563e+00,  8.8105e-03,  3.2474e+00,
        -3.3685e+00, -3.2560e+00, -1.8959e+00, -1.7813e+00,  2.0407e-02,
        -8.4642e-02,  1.6362e-02, -2.9816e-01,  3.8991e-01,  2.4600e+00,
        -1.8367e-01, -2.3918e+00,  4.9872e-01, -1.8592e+00, -3.4756e-01,
        -1.1665e-01, -8.7580e-01, -2.2106e-01, -9.5188e-02, -1.1781e+00,
        -1.3122e+00, -8.9549e-01, -5.7753e-01, -2.0093e+00,  5.4931e-01,
        -2.1184e+00,  1.2397e+00, -3.4735e-03,  2.5698e+00, -3.9197e-02,
         2.0564e+00,  3.4303e+00, -1.9335e-01, -2.4360e+00, -3.2044e-01,
        -1.0545e+00, -8.7200e-01,  1.5924e+00,  1.6725e+00,  1.1397e+00,
         1.0722e+00, -7.3818e-01, -1.9950e+00, -1.5235e+00, -2.4522e+00,
         1.7877e+00, -2.3395e+00,  1.4458e+00, -5.0613e-01,  2.8556e+00,
         1.9030e+00, -1.5011e+00,  4.5441e-01, -8.1583e-01,  1.5179e+00,
         6.2569e-01, -3.9473e-01, -6.5793e-01,  5.6727e-01,  1.5174e+00,
         9.6513e-01,  5.2746e-02,  1.5928e+00,  2.1778e+00,  1.1725e+00,
         8.4986e-01,  4.4523e-01,  7.5059e+00,  2.3648e+00,  1.6722e+00,
        -2.6010e+00,  5.4671e-02, -1.8805e-01,  1.8888e-01, -1.3396e+00,
         4.5909e+00,  8.8980e-01,  1.4295e+00,  1.8514e+00, -1.0145e+00,
        -3.2470e-01,  5.0001e+00,  8.1893e-02, -3.5181e-01,  4.4792e+00,
        -5.5020e-01,  2.9889e+00, -6.8980e-01, -3.1972e+00,  1.7933e-01,
        -2.6241e+00, -9.5679e-01, -6.0024e-01,  1.2580e+00,  1.2905e+00,
         2.0667e+00, -3.6082e-01,  3.8706e-02,  4.4496e-01,  1.1072e+00,
         1.1132e+00, -5.3924e-02,  5.4479e-01, -2.0688e+00, -2.3290e-01,
        -9.2725e-01,  1.0239e-02,  1.1833e+00, -8.5065e-02,  1.3230e+00,
         5.9064e-01,  3.4532e-01,  1.7668e+00, -1.6129e+00,  5.0465e-01,
         5.6302e-02,  9.0209e-01,  7.0151e-01,  1.2357e+00,  1.2606e+00,
        -1.4353e+00, -2.7879e-01, -1.9161e+00, -1.5331e+00,  9.3219e-01,
         1.6700e+00,  5.9826e-01, -3.8560e-01]]]

SEP_TOKEN_LAST = [[[ 3.0189e-01, -2.5529e-01,  1.4629e+00,  4.5519e-01, -3.8224e-01,
        -1.4822e-01, -6.0051e-01,  6.8798e-02,  2.2836e-01,  5.8469e-01,
         2.3426e-01, -2.1427e-01, -8.5876e-03,  7.6328e-01,  7.5599e-02,
        -5.4520e-01, -1.3972e-02,  5.7521e-01, -2.8283e-01,  2.5617e-01,
         6.0398e-01,  5.8521e-01, -9.5447e-01,  2.2957e-01, -1.4741e-01,
        -4.9010e-01, -4.9831e-01,  7.5135e-01, -3.7686e-02, -3.0544e-01,
        -3.2808e-01,  1.6228e-01, -6.0053e-02,  1.5191e-01,  1.2878e-01,
        -1.9160e-01, -3.6014e-01,  8.3957e-02,  5.2130e-01, -4.4580e-01,
        -7.4543e-01, -1.3172e-01, -1.0000e+00, -1.4557e-02, -5.5536e-02,
         1.0550e+00, -8.2793e-01, -3.3638e-01,  2.3616e-01, -9.1917e-01,
        -8.1125e-02, -3.6077e-01,  2.6480e-01, -1.8828e-01, -2.4366e-01,
        -4.6373e-02,  4.4713e-01, -3.1026e-01, -7.4493e-01, -3.2361e-02,
        -2.8418e-03,  4.3949e-01, -3.0004e-02, -7.7149e-02, -4.6887e-01,
        -1.6154e-01, -2.7370e-01,  4.0312e-01, -3.7343e-01, -7.4343e-02,
         6.9120e-01, -3.2669e-01,  3.5765e-01,  8.3631e-03, -3.4636e-01,
        -8.1082e-01,  3.4482e-01, -5.2160e-01, -3.7172e-01,  4.4783e-01,
        -3.2409e-01,  5.6477e-01, -6.8776e-01,  1.9463e-01, -1.0825e-01,
         5.0027e-02,  3.3473e-01,  3.5045e-01, -3.7135e-01, -3.6770e-01,
        -1.5917e-01, -5.5404e-01, -4.4279e-03,  9.5427e-02, -1.4479e-01,
         7.1158e-01,  2.0625e-01,  3.3385e-02,  5.4154e-01, -1.0608e-01,
        -2.9179e-01,  5.8603e-01,  1.7002e-02, -1.0590e-01, -6.3680e-01,
         2.3602e-01, -6.1397e-02,  5.7649e-01, -3.6940e-01,  4.5514e-01,
         5.4438e-02,  2.4336e-01,  5.0396e-01, -2.6552e-01,  7.0087e-02,
        -1.8276e-01, -8.2182e-01, -5.3055e-01, -6.6160e-01, -2.6384e-01,
         4.2313e-01,  3.5931e-01,  4.2876e-01, -9.0582e-01, -2.3105e-01,
        -5.1943e-01,  1.7473e-01,  4.3821e-01,  8.0384e-01,  5.6571e-01,
        -1.2526e-01,  4.4929e-01, -6.8290e-01, -1.0106e-01, -2.0510e-01,
         2.9089e-01,  2.6474e-01, -1.3458e-01,  5.5482e-03,  3.0381e-01,
         1.1076e-01,  1.8852e-01, -4.6844e-01, -5.9284e-01, -2.8661e-01,
         1.5130e-01, -1.5669e-01,  7.0852e-01,  1.0359e-01,  4.8342e-02,
         4.9207e-01, -8.0626e-01,  1.8827e-01, -3.9689e-01, -1.2300e-01,
         5.2493e-02,  3.9883e-02, -1.2116e-01, -6.5282e-02,  4.4469e-01,
         7.9306e-01, -1.8437e-01,  1.2368e-01,  1.0622e+00, -2.2137e-01,
         6.8200e-02,  3.6871e-01, -2.3177e-01, -6.7864e-01, -6.6165e-02,
        -7.1799e-03, -3.2682e-01, -4.2991e-01, -5.6928e-01, -8.8158e-01,
        -1.6098e-01, -4.9119e-01,  6.2446e-02, -7.5597e-02,  4.2138e-01,
         1.8698e-01,  4.3405e-01, -6.5755e-02, -4.0998e-01,  3.1563e-03,
         2.3256e-01,  6.2951e-02, -1.9107e-02, -2.4881e-01,  7.5473e-02,
         6.6099e-01,  3.7923e-01, -4.3603e-01, -1.0845e-01,  5.7115e-01,
         6.4919e-01,  2.7247e-01, -4.6922e-01, -1.6438e-02,  1.7917e-01,
        -3.4709e-01,  3.5517e-01,  5.4936e-02, -9.8488e-02, -1.0724e-01,
         1.4402e+00,  7.4835e-01, -1.0098e+00,  8.3234e-01,  5.6463e-01,
        -4.0786e-01, -9.6382e-02, -2.5235e-01,  6.6740e-01,  7.2854e-03,
         4.3867e-01,  1.2597e-01,  2.0644e-01,  1.5649e-01, -1.7117e-01,
         4.3215e-02, -2.5159e-01, -1.5349e-01, -5.5891e-01, -5.4188e-01,
        -6.5780e-01, -3.5490e-01,  2.4389e-02,  8.4041e-01, -5.8440e-01,
         1.7948e-01, -5.1880e-01, -1.0943e-01, -3.4661e-01, -6.8654e-03,
        -3.0551e-01,  6.6198e-03, -6.3362e-01, -6.7414e-01, -3.2082e-01,
        -1.8555e-01,  2.1383e-01,  1.2178e-01, -2.1072e-01, -3.1788e-02,
        -8.4061e-02, -2.1376e-01, -1.3981e-01, -4.7345e-02, -8.2269e-01,
         4.3519e-01,  8.8295e-02,  1.4832e-03, -3.6422e-01,  2.2114e-01,
         4.5643e-01,  6.2677e-01, -3.2398e-02,  6.8201e-01, -2.1848e-01,
         1.3418e-01, -3.9482e-01, -3.0009e-01, -1.0878e-01, -1.0941e-01,
        -4.2410e-01,  3.3103e-02,  1.8106e-01,  3.0628e-01,  2.8410e-01,
         2.8899e-01,  9.2706e-01, -8.6884e-02, -2.4299e-02,  3.1605e-02,
         4.9708e-01,  2.9750e-01,  5.4663e-01, -3.2467e-01, -1.1326e-02,
         6.0710e-02,  8.8597e-02,  3.4669e-02,  1.0800e-01,  5.8490e-02,
        -1.6711e-01,  2.6920e-01, -1.9959e-01, -4.2153e-01, -2.5044e-01,
         2.1310e-01,  1.2102e-01, -2.7066e-01, -9.3553e-02, -1.8129e-02,
         1.8171e-01, -2.6124e-01,  1.9924e-01,  3.5155e-01, -7.1505e-02,
         1.8531e-01,  1.2016e-01, -8.1903e-01,  1.5982e-01, -5.8942e-01,
         4.6364e-01, -1.3995e-01, -1.4046e-01,  4.8599e-01,  2.5382e-01,
        -9.0217e-01, -1.0852e-01,  3.4758e-01, -9.8455e-03, -8.2325e-01,
        -3.1473e-01,  1.7201e-01,  3.2466e-01,  4.0300e-01,  8.7111e-02,
         8.8473e-02, -1.5919e-01,  1.0721e-01, -1.2670e-01,  3.9785e-01,
         4.3994e-01, -4.4809e-01, -1.6542e-01,  2.7846e-01,  8.7392e-02,
        -1.5757e-02,  8.4958e-01, -1.8778e-01, -2.6345e-01, -1.5427e-01,
         3.5247e-01, -1.0962e-03, -2.7874e-01, -1.8556e-01, -3.7965e-01,
         4.2574e-01, -8.4321e-01,  5.4584e-01, -1.4345e-01,  4.8694e-01,
        -2.9867e-02,  1.9130e-01, -2.1423e-02,  2.4037e-01, -4.9818e-02,
        -1.5452e-01, -2.0749e-01, -5.9896e-01,  5.0829e-01,  1.5091e-01,
        -5.9058e-01, -2.7245e-01, -2.2246e-01, -2.9602e-01,  4.6328e-01,
        -4.9796e-01,  1.3755e-01,  1.2589e-01, -1.5301e-01,  2.0300e-01,
         5.5385e-01, -5.4084e-01,  2.1284e-01, -2.8000e-02,  9.2035e-01,
         7.4410e-01,  2.8275e-01, -5.9594e-01, -6.6135e-02, -5.8032e-01,
        -4.4504e-02,  1.3098e-02, -4.5834e-01,  2.2121e-01, -2.0599e-01,
         5.0489e-01,  8.1715e-01, -1.9631e-01,  6.3253e-01,  1.9556e-01,
        -3.8656e-01, -7.9173e-02,  7.4741e-02,  1.2270e-01, -2.6259e-01,
        -3.5805e-02, -1.5046e-01, -1.1335e-01,  7.1068e-01, -7.1346e-01,
         2.4830e-01, -4.5773e-01, -1.3067e-01,  1.0440e-01, -1.0812e-01,
         5.4889e-01, -1.6784e-01, -3.2681e-01,  7.4063e-01,  5.3706e-02,
        -3.7852e-05,  8.6383e-02,  5.0476e-01, -4.7660e-01, -1.3325e-01,
        -3.4176e-01,  1.3345e-01,  1.6022e-01, -1.2152e-02,  1.5763e-01,
         6.7020e-01, -7.5859e-01, -1.7358e-01,  7.2280e-02,  4.3240e-02,
        -4.3075e-03, -7.3920e-02, -1.6795e-01, -7.6580e-01, -3.5675e-01,
         3.9769e-01,  5.9325e-01, -7.3829e-01,  3.5857e-01, -3.3185e-01,
        -7.9359e-01,  5.9205e-01,  4.0315e-01, -2.7246e-01, -1.4486e-01,
        -2.3572e-01, -1.3774e-01,  3.9210e-01, -8.7145e-02,  4.1713e-01,
        -3.0479e-01,  3.9139e-01,  6.0404e-02, -2.1743e-01, -1.8146e-02,
         4.3676e-01, -3.7217e-01, -2.9147e-01,  4.0721e-01,  1.7729e-01,
         1.3219e-01, -7.9023e-01, -5.4846e-01, -5.3607e-01,  3.6902e-01,
         4.9143e-01, -2.5692e-01,  1.0590e-01,  4.5561e-01,  6.4930e-01,
         9.6152e-02, -2.7074e-01,  7.2670e-01,  2.1170e-01,  5.1932e-01,
         5.3948e-02,  3.4045e-01,  2.9824e-01, -4.6675e-02,  2.3311e-01,
        -4.1668e-03,  3.2108e-01, -1.3460e-01, -6.4897e-04, -7.3352e-01,
        -1.7700e-01, -4.9759e-02, -1.1621e-01,  5.4028e-01, -5.2409e-01,
         3.8891e-02, -3.4355e-01,  2.8468e-01, -3.0314e-01,  2.1979e-01,
         7.6617e-01,  6.0949e-01,  5.2721e-01, -1.7303e-02,  6.2798e-02,
         3.3668e-01,  2.3627e-01,  2.5067e-01, -7.9008e-01,  4.6222e-02,
         4.2460e-01,  5.5014e-01, -1.0598e-02,  1.7128e-01,  5.3251e-01,
        -2.6933e-01,  2.2765e-01,  2.7370e-01,  1.2268e-01,  1.1228e-01,
        -5.5553e-01, -7.7470e-01, -1.3345e-01, -2.1833e-01, -3.0769e-01,
         1.5239e-01, -2.6266e-01, -2.3268e-01, -1.6251e-01,  6.7635e-02,
         5.2135e-01,  4.7423e-01, -4.2162e-01,  4.3120e-01,  5.2986e-01,
        -1.8262e-01, -1.3248e-01, -6.1168e-01, -3.0569e-01, -3.2973e-01,
         2.5396e-01, -2.1894e-01, -4.7494e-01,  1.2226e-01,  4.7116e-03,
        -2.5434e-01, -1.2304e-01, -1.0503e-01, -3.0377e-02, -1.1113e-01,
         9.6045e-02,  4.6022e-01, -2.9014e-01, -6.7943e-01, -2.6724e-01,
         1.3994e-01,  2.4344e-01,  6.1384e-02,  2.5030e-01,  1.9643e-01,
         5.0429e-01,  4.0376e-02,  1.3269e-01,  5.0054e-01,  7.3174e-02,
        -5.0146e-02,  4.5143e-01,  3.3725e-01, -1.3945e-01,  5.6816e-02,
         1.3972e-01, -4.5153e-01, -3.7781e-01, -3.2271e-01,  4.3427e-01,
         7.2214e-01, -9.8524e-02, -7.7736e-02, -1.6067e-01,  2.6945e-01,
        -3.7876e-01, -2.4835e-01,  6.1448e-01,  1.9783e-01,  3.3891e-01,
         2.5847e-02, -1.7894e-01, -9.5680e-03,  1.2157e-01,  3.2696e-02,
         3.0446e-01, -3.3420e-01, -2.0139e-01,  4.6833e-01, -1.3489e-01,
         2.8951e-01,  3.1233e-01, -1.4186e-01, -7.3750e-02, -7.5680e-01,
         1.3466e-01,  6.4039e-02,  9.3824e-02, -3.9892e-01, -5.1487e-01,
         3.3325e-01,  4.1232e-01,  3.4365e-01,  2.0393e-02,  4.7713e-01,
         8.0988e-01,  1.1281e+00,  1.4344e-01, -2.9056e-01, -2.5558e-01,
        -1.8056e-01, -3.6835e-01,  1.1868e+00, -2.2255e-01, -2.3383e-01,
        -4.1872e-01,  4.6106e-01, -1.4919e-01, -6.3747e-01,  3.6408e-01,
         9.7458e-02, -1.8107e-02, -1.5008e-01,  4.1541e-01, -1.7235e-01,
         2.3746e-02,  2.4346e-01,  3.0579e-01, -3.3282e-01, -4.5745e-02,
        -2.2263e-01,  1.0059e+00, -2.4094e-01, -4.9427e-01,  1.0137e-01,
         2.5100e-02,  1.4303e-02, -7.7520e-01, -3.2857e-01, -4.8110e-02,
        -2.4030e-01, -2.6125e-02, -1.5983e-01, -7.8815e-01, -2.8381e-02,
        -3.2352e-01, -2.7224e-01, -1.0564e-01,  5.9725e-02,  8.4573e-02,
        -3.1499e-01, -9.8802e-02, -3.4889e-01,  2.0299e-01,  4.0688e-01,
        -1.6850e-01, -3.2899e-01,  6.6755e-01,  1.1524e-01,  5.1799e-02,
        -9.5812e-02, -4.1601e-01, -1.2050e-01, -3.5383e-01,  2.6595e-01,
         8.6742e-02,  3.5456e-01, -4.6702e-01, -3.8889e-01,  2.9923e-01,
         3.8240e-01, -2.9566e-01,  3.4647e-02,  5.3712e-02, -5.6863e-01,
         3.7760e-03,  1.5177e-02, -4.2344e-03,  2.1412e-01,  1.8034e-02,
         8.1714e-02, -4.6129e-02,  2.6078e-01, -4.1492e-01,  3.1224e-02,
        -7.3244e-01, -4.5668e-01,  5.1611e-01,  2.4078e-01, -5.8895e-01,
        -2.6576e-02,  3.9338e-01,  1.2640e-01,  3.1298e-01,  2.3647e-01,
         3.0935e-01, -1.7301e-01,  1.2463e-01,  2.5288e-01,  2.5863e-01,
         4.2878e-01, -8.7667e-02, -6.6137e-01, -7.4203e-01,  1.5034e-02,
        -1.3431e-01,  1.2069e-01,  2.8415e-01, -1.5856e-01, -6.9000e-01,
         1.5241e-01, -4.2305e-01,  4.2466e-01,  2.5213e-01, -2.2670e-01,
        -1.9939e-02,  7.1044e-01, -6.3305e-02,  7.4145e-02, -8.4626e-02,
        -2.6913e-01,  5.7152e-01, -2.5495e-01,  2.9162e-01, -9.9288e-01,
         3.0936e-01, -4.6971e-02, -5.0349e-01,  3.1125e-01,  6.4420e-01,
         2.8724e-01,  4.0055e-01, -5.6465e-01, -4.0702e-01,  1.0948e-01,
         1.6701e-01,  3.6071e-01,  2.0779e-01, -4.9090e-01, -2.4701e-01,
        -9.7808e-02, -1.2888e+00,  2.9601e-01,  5.2111e-01,  2.7286e-01,
         2.5942e-02,  5.6318e-01,  4.1021e-01, -1.0151e-01,  5.0744e-01,
        -8.4221e-01, -4.9680e-02,  1.8904e-01,  6.4304e-04,  5.6333e-02,
        -7.7275e-01, -2.9252e-01, -5.0544e-01, -3.6466e-01, -5.9732e-02,
         3.3965e-01, -2.2750e-01,  1.0032e-02,  1.2806e-02,  2.7206e-01,
         4.7281e-01,  3.8706e-01,  4.0129e-01, -2.1555e-01,  2.4644e-01,
        -6.4581e-01, -1.2998e-01,  1.5128e-01,  7.0040e-02,  1.5260e-01,
        -1.4658e-01,  3.0013e-01, -6.6902e-02]]]
SEP_TOKEN = [[[ 1.3052e+00, -8.8454e-01,  3.9420e+00,  2.9212e+00, -7.4760e-01,
        -1.4004e+00, -4.2691e+00,  1.0058e+00,  9.3634e-01,  8.7318e-02,
         4.4450e+00, -7.6798e-01, -2.2523e+00,  4.3193e+00,  9.8109e-01,
        -4.2802e+00, -8.5205e-01,  5.7751e-01, -5.3271e-02,  1.8379e+00,
         2.2957e+00,  2.4235e+00, -3.6891e+00,  2.7482e+00, -2.4190e+00,
        -3.3726e+00, -2.4612e+00,  8.9109e-01, -1.8069e-01,  2.5627e-02,
        -2.1193e+00, -1.3603e+00,  3.5568e+00,  2.1113e+00, -4.4327e-02,
        -1.2876e+00, -2.0521e-01, -1.7673e+00,  2.7841e+00, -8.7148e-01,
        -5.3895e+00, -2.4788e-01, -3.6507e+00,  2.5103e+00, -4.2420e-01,
         5.9025e+00, -2.7390e+00, -7.8364e-01,  2.5199e-01, -3.3629e+00,
         1.7674e+00, -2.3098e+00, -4.4025e-01,  1.7677e+00, -2.2532e+00,
        -1.9096e+00,  1.8539e+00, -1.8253e+00, -3.0496e+00,  1.9612e+00,
         1.1122e+00,  4.6366e-01, -2.6624e+00, -5.8198e-01, -4.7254e+00,
        -3.1669e+00, -4.1150e-01, -5.3657e-01, -9.6246e-01, -5.0384e-01,
         4.1687e+00,  5.3340e-01,  1.5481e+00,  1.0387e-01, -8.2488e-01,
        -3.4651e+00, -8.9599e-01, -4.8076e-01, -1.3406e+00,  5.5254e+00,
        -6.9998e-01,  2.4304e+00, -6.5684e-01, -8.7080e-01,  3.9153e-01,
        -1.1106e+00,  9.3100e-01, -1.1203e+00, -9.7696e-01, -1.0278e+00,
         1.6512e+00, -3.3379e+00,  2.2248e+00, -3.4543e-01, -1.5230e+00,
         3.4983e+00,  1.3176e+00, -1.2392e+00,  3.7801e+00, -4.2259e-01,
        -3.5596e-01,  2.0253e+00, -1.9350e+00, -7.2813e-01, -1.5590e+00,
         2.7439e+00,  5.3254e-01,  2.3060e+00, -1.0589e+00, -8.9268e-01,
        -1.2320e+00,  3.0696e-01,  1.5372e+00, -4.5038e-01, -1.3326e+00,
         1.6171e+00, -5.8980e+00, -3.2488e+00, -1.4146e+00, -4.6989e+00,
        -1.5633e+00,  2.1260e+00,  5.1421e+00, -7.5083e-01, -1.0660e+00,
        -5.7229e-01,  8.5680e-01,  1.1605e+00,  1.8206e+00,  3.7710e+00,
         1.0393e+00,  2.5485e+00, -5.3729e+00, -8.1368e-01, -2.3081e+00,
        -1.3815e+00,  3.2137e-01, -1.9378e+00, -1.5393e+00, -1.2318e+00,
         3.2828e+00, -1.6894e+00,  5.6435e-02, -4.5254e+00, -2.1159e+00,
         1.1383e-01,  6.0949e-01,  2.3983e+00,  1.2745e-01, -1.3161e+00,
         2.1562e+00, -2.9474e+00,  4.7895e-01, -2.2332e+00,  5.9223e-01,
        -1.8189e-01,  1.3456e-01, -2.0433e+00, -2.7031e+00,  2.4984e+00,
         2.8381e+00, -1.5603e-01,  6.9645e+00,  4.3123e+00, -2.8263e+00,
         1.8894e+00,  1.8605e-02, -2.7477e+00, -3.3621e+00, -1.3458e+00,
        -5.6412e-01,  6.5999e-01, -3.3050e+00, -4.8362e+00, -5.0586e+00,
         1.7593e+00, -5.9514e+00, -1.2598e+00, -3.1382e+00, -1.1416e-01,
         8.3984e-01,  8.8764e-01, -2.2060e-02, -1.1678e+00,  1.3315e+00,
         9.9065e-01, -1.5960e+00, -2.4745e+00, -3.0281e+00,  2.5302e+00,
         2.8997e+00,  3.5901e+00,  1.5261e+00, -3.0774e-01,  2.0744e-01,
        -2.1928e+00, -1.5888e+00, -3.8376e+00, -2.3577e+00,  1.1194e+00,
        -3.4555e+00,  1.0655e+00, -1.3234e-01,  4.9951e-01, -1.2449e+00,
         7.7985e+00,  3.7497e+00, -4.5972e+00,  7.9363e+00,  2.9508e-01,
        -2.0663e+00, -9.0172e-02,  1.4825e+00,  3.1038e+00,  1.6057e+00,
         1.8910e+00,  8.1707e-01, -9.8670e-01,  2.3663e+00,  3.0062e+00,
        -1.7963e+00, -1.5576e+00,  9.9436e-01, -4.1423e+00, -1.7618e+00,
        -2.2718e+00,  6.3811e-01, -7.2198e+01,  4.4263e+00, -9.6481e-01,
         5.9279e-01,  5.0193e-01,  6.2746e-01, -3.8080e-01, -2.0997e+00,
        -3.2589e+00, -6.4658e-01, -2.3881e+00, -2.4788e+00,  6.9757e-02,
        -2.9433e-01,  2.5801e+00, -1.5754e+00,  8.8788e-01, -1.2596e+00,
        -5.5194e-01, -5.8057e-02, -9.2736e-01, -7.8881e-01, -3.9131e+00,
        -2.6968e-01,  2.2014e+00,  2.7031e-01,  4.2599e-01,  1.5644e+00,
         1.9967e+00,  3.5892e+00, -8.7870e-02,  2.2500e+00, -8.9392e-01,
         3.1505e+00, -9.1926e-02,  1.1375e+00, -7.8907e-02, -8.0978e-02,
        -2.1202e+00, -1.6090e+00,  4.0684e-01,  3.1616e+00,  1.2230e+00,
         5.1211e+00,  3.1199e+00, -1.2015e+00,  1.4967e+00, -6.2299e-01,
         2.6920e+00,  1.4635e+00,  3.9137e+00,  6.8705e-01, -1.3306e+00,
        -1.1388e+00, -3.3537e-01, -1.9724e+00, -2.0707e+00,  1.0760e+00,
         2.2031e+00,  5.5901e-01, -7.1506e-01, -1.0058e+00, -9.8779e-01,
         1.7115e+00,  1.8295e+00,  2.3107e+00, -2.9258e+00, -1.1408e+00,
         1.4809e+00, -2.4234e+00,  2.2449e+00,  3.3672e-01, -8.1373e-01,
         2.4748e+00, -2.6557e+00, -2.8618e+00,  1.8189e+00, -2.4151e+00,
         2.1041e+00, -1.7694e+00, -1.2318e+00,  3.9030e+00, -2.8999e-01,
        -1.1818e+00,  7.5119e-02,  1.1055e+00, -2.9381e+00, -5.7786e+00,
        -3.8177e+00,  2.9284e+00,  6.2326e-01,  2.3720e+00,  1.7967e-01,
         1.8523e+00,  1.1153e+00, -1.2998e+00, -7.8121e-01,  1.0597e+00,
        -1.6069e+00, -3.1162e-01,  4.6110e-01,  4.8429e+00, -2.7742e+00,
         1.1999e+00,  2.2914e+00, -2.2909e+00, -4.9487e-01, -2.4039e-01,
         1.2972e+00, -7.6200e-01, -1.0693e+00,  1.0433e+00,  1.6664e+00,
         3.5403e+00, -3.9154e+00, -3.1415e+00, -2.5328e+00,  6.7581e-03,
        -6.3522e-01, -3.1744e-01, -1.4678e+00, -8.9943e-01,  1.4635e+00,
         3.5101e-01, -7.6733e-01, -3.3933e+00,  1.4538e+00,  4.9858e+00,
        -3.7231e+00,  2.8010e-01, -1.6958e+00, -2.6822e+00,  2.0971e+00,
        -1.8675e-01, -1.4847e+00, -2.9516e-02, -3.4279e+00,  9.6573e-01,
         2.6128e-01, -4.2206e+00, -1.2225e+00,  1.4003e-01,  3.4790e+00,
         1.7472e+00, -1.8695e+00, -8.7009e-01, -1.4155e+00, -4.0977e+00,
        -5.8473e-01,  3.5427e-01, -6.2433e-01,  1.5617e+00, -1.9378e-01,
         1.4368e+00,  2.2975e+00,  4.1358e-01,  3.2798e+00, -5.4702e-01,
        -1.8615e+00,  1.5577e-01, -6.6117e-02,  3.6565e-01, -2.8168e+00,
        -3.7744e-01,  2.2051e-01, -2.8976e+00,  1.7630e+00, -6.0939e+00,
         1.3806e+00, -1.8794e+00,  7.0514e-01, -7.7315e-01, -2.5178e+00,
         2.5212e+00, -3.1893e+00, -3.0262e+00,  4.0662e+00,  2.7002e-01,
        -3.2854e+00, -1.5755e+00,  1.7839e-01,  4.2559e-01, -1.7737e+00,
         1.0132e+00,  1.6644e+00,  7.4948e-01, -1.2839e+00,  2.6566e+00,
         3.2260e+00,  4.3816e-01, -4.9374e-02, -1.0555e-01, -2.4680e+00,
        -3.7118e+00, -2.8868e+00, -1.1032e+00, -1.3539e+00, -4.9948e-01,
         2.7453e+00,  1.9111e+00, -3.6277e+00,  1.3680e+00, -2.8070e+00,
        -4.1167e+00,  2.8067e+00,  2.7646e+00, -5.8053e-01, -2.0421e+00,
        -5.6744e-01, -2.3143e+00,  3.4535e+00,  2.2648e+00,  2.5728e-01,
        -2.0017e+00,  3.0034e-01, -1.6492e+00, -3.1626e+00, -9.5326e-01,
        -8.5853e-01, -1.5139e+00, -2.0038e-01,  1.8789e+00, -1.7010e+00,
        -1.9450e-01, -4.2845e+00, -4.2362e+00, -2.7274e+00,  1.2140e+00,
         1.8612e+00, -2.8471e+00,  1.3112e+00,  4.2515e+00,  5.1224e+00,
         1.2152e+00, -7.9600e-01,  2.0966e+00,  2.0864e+00,  2.5353e+00,
         1.7354e+00,  3.7465e+00,  1.9743e+00, -5.5610e-01,  1.3984e+00,
        -9.4397e-01,  7.3280e-01, -1.1367e+00, -9.5454e-02, -2.6571e+00,
         1.3056e+00, -2.4898e+00,  1.6665e-01,  2.8450e+00, -2.9603e+00,
         2.5806e+00, -2.7983e+00, -3.4604e-01, -2.3105e+00,  1.5205e+00,
         3.3754e+00,  3.2602e+00,  2.3481e+00,  1.3181e+00,  1.3542e+00,
         2.8152e+00, -1.7840e+00,  2.8527e+00, -2.8709e+00,  5.2262e-01,
         4.8759e+00, -4.8707e-02, -1.0353e-01,  1.1814e+00,  2.1793e+00,
        -6.0875e-01,  2.9442e+00,  4.9848e-01,  1.1899e+00, -1.1600e+00,
        -3.0720e+00, -4.5347e+00, -2.1036e+00, -2.9704e+00, -2.0809e+00,
        -8.9104e-02,  6.8941e-01, -8.4162e-02, -1.0283e+00,  1.1712e+00,
         2.8238e+00,  4.2761e+00, -3.3947e-01,  2.6334e+00,  4.1859e-01,
        -2.0913e-01, -1.4624e+00, -1.6941e+00, -8.0871e-01, -1.7444e+00,
         2.1111e+00,  1.0029e+00, -2.1354e+00, -2.4165e-01, -1.0219e+00,
        -2.5793e+00, -9.1229e-01, -1.8936e+00, -2.8254e-01, -1.9580e+00,
        -2.3360e+00,  8.0318e-01,  1.3151e+00, -4.1116e+00, -1.1322e+00,
         7.8318e-01, -9.2039e-01, -7.5748e-01,  1.6629e+00,  1.5073e+00,
         1.3835e+00, -2.2405e+00,  1.8469e+00,  1.6659e+00,  1.1599e+00,
        -6.3986e-01,  2.0375e+00,  6.8769e-01,  9.5286e-01,  3.0995e-01,
         1.6953e+00, -1.4447e+00,  1.9453e-01, -2.0662e+00,  2.6396e+00,
         4.6331e+00, -1.6130e-01, -9.3845e-01, -2.9468e+00,  1.5681e+00,
        -4.5752e+00, -2.1546e+00,  3.3218e+00,  2.9224e+00,  1.4925e+00,
         7.6807e-01, -2.2679e+00,  9.1174e-01,  5.4062e-01, -2.4179e+00,
         7.2256e-01, -2.0421e+00, -1.9396e+00,  5.7239e-01,  5.8328e-01,
        -9.0631e-01,  1.1980e+00, -1.6975e+00, -2.0605e-01, -1.0853e+00,
         9.7550e-01, -1.4918e+00, -9.4925e-01, -5.9373e-01, -4.2239e+00,
        -2.3685e+00,  1.2558e+00,  8.6244e-01, -1.4108e+00,  1.2513e+00,
         4.8821e+00,  6.5220e+00,  2.3377e+00, -1.8218e+00, -2.0142e+00,
         1.7137e-01, -1.5135e+00,  3.4989e+00, -5.7815e-01,  1.4154e+00,
        -1.5567e+00,  3.1973e+00, -2.1840e+00, -2.4963e+00,  2.5038e+00,
         1.2755e+00,  4.1681e-01, -2.5471e-01,  2.0865e+00,  2.4764e+00,
         1.8647e+00,  1.2418e+00,  1.4610e+00, -1.0235e+00, -2.2777e+00,
        -8.7755e-01,  3.5975e+00, -3.5917e+00, -5.2382e+00,  3.2380e+00,
         2.1636e+00, -9.9884e-01, -2.5491e+00, -3.3959e+00, -7.9524e-01,
        -2.5362e+00, -2.8073e-02, -8.7400e-01, -2.5975e+00,  1.4500e+00,
        -1.2840e+00, -2.2744e+00, -1.0830e-01,  1.6112e+00, -2.6649e-01,
        -2.9804e+00, -1.4664e+00, -2.7206e+00,  1.4698e+00,  5.0069e-01,
        -1.1131e+00, -2.4049e+00,  4.0729e+00, -1.5829e-01,  3.2900e-01,
        -2.2620e+00, -3.2851e+00, -2.4999e-01, -1.6428e+00,  1.8240e+00,
        -8.2227e-01,  1.7757e+00, -2.3231e+00, -2.0414e+00, -1.4543e+00,
         1.2809e+00, -6.5015e-01,  5.6258e-01,  2.8888e-01, -2.3285e+00,
         2.0710e-01,  3.3772e+00,  1.0740e+00,  5.3740e-01,  6.2589e-01,
        -8.5630e-01,  9.1088e-01,  2.2626e+00, -3.8083e+00,  4.5271e-01,
        -1.0353e+00, -4.0168e+00,  2.4266e+00, -9.1056e-01, -5.1760e+00,
         2.9989e-01,  1.7090e+00,  1.1771e+00,  1.6621e+00,  8.1611e-01,
        -9.8795e-02, -1.1255e+00, -1.1002e+00,  1.3495e+00,  3.3544e+00,
        -8.7717e-01, -7.1907e-01, -3.0078e+00, -3.6728e+00, -6.6552e-02,
         1.4508e+00, -1.7085e-01,  1.7405e+00,  9.1847e-01, -2.8776e+00,
         1.5079e+00, -1.3070e+00,  4.2018e+00,  4.1521e+00, -3.1692e+00,
        -7.6177e-01,  5.0602e+00, -1.1849e+00,  1.8629e+00,  8.6367e-01,
        -2.6493e+00,  4.7614e+00, -1.9396e+00, -7.6592e-01, -4.3654e+00,
         2.0778e+00,  6.5592e-01, -5.5239e+00,  3.6141e+00,  1.7159e+00,
         1.0170e+00,  5.1981e-01, -2.3114e+00, -2.9826e+00, -4.4041e-01,
         2.1551e+00,  4.3420e+00,  1.9341e+00, -2.7467e+00, -8.6029e-01,
        -1.5480e+00,  4.2129e+00,  1.4176e+00,  3.2752e+00, -3.8022e-01,
         3.1427e-01,  4.8154e+00,  3.3168e+00,  7.5620e-01,  2.2155e+00,
        -3.2378e+00,  1.4331e+00,  2.0399e+00,  2.5182e-01,  1.6511e+00,
        -2.5549e+00, -1.1659e+00, -1.9206e+00, -1.7779e+00,  6.1308e-01,
         4.3771e+00, -1.9752e+00, -1.7231e+00, -1.2885e-02,  2.0080e+00,
         2.0106e+00, -1.2382e-01,  4.3564e+00, -2.5311e-01, -2.0908e+00,
        -4.8612e+00,  1.5140e+00, -1.6781e-02, -6.7198e-01,  1.0206e+00,
         2.0673e-02,  4.3746e+00,  1.7054e+00]]]
    
class ShuffledLambdaTermsDataset(Dataset):
    def __init__(self, input_sentences_file, main_dir, transform=None, target_transform=None, last=False):
        self.main_dir = main_dir
        self.input_sentences = pd.read_csv(input_sentences_file)
        self.transform = transform
        self.target_transform = target_transform
        self.last = last
    
    def __len__(self):
        return len(self.input_sentences)

    def __getitem__(self, index):
        sentence = self.input_sentences.iloc[index, 1]
        if sentence[0] == '""': sentence = sentence[1]
        if sentence[-1] == '""': sentence = sentence[:-1]
        path = self.input_sentences.iloc[index, 2]
        path = DATA_PATH + path[len("lambdaBERT/data/"):]
        with open(path, 'r') as f:
            lambda_terms = f.readlines()[0].strip()

        # remove the ")" from the lambda_term:
        lambda_terms = lambda_terms.replace(")", "")
        sent_embs, target_embs, target_embs_last, target_tokens, var_index_mask_no, lambda_index_mask, app_index_mask = torch.load(path.replace("txt", "pt"))#create_out_tensor(sentence, lambda_terms)

        #attach the CLS and SEP tokens to the start and end of target_embs?

        if len(target_embs) == 0:
            if "section_6186/4.txt" in path or "section_4652/5.txt" in path or "section_7065/2.txt" in path or "/section_5020/4.txt" in path:
                target_embs = torch.Tensor()
                target_tokens = []
                assert len(lambda_index_mask) == 0 
                assert len(var_index_mask_no) == 0
                assert len(app_index_mask) == 0

                # lambda_index_mask.append(0)
                # var_index_mask_no.append(0)
                # app_index_mask.append(0)
            else:
                raise Exception

        
        #sep token for target embedding:
        target_embs = torch.cat([torch.tensor(BOS_TOKEN).squeeze(0), target_embs, torch.tensor(SEP_TOKEN).squeeze(0)], dim=0)
        target_embs_last = torch.cat([torch.tensor(BOS_TOKEN_LAST).squeeze(0), target_embs_last, torch.tensor(SEP_TOKEN_LAST).squeeze(0)], dim=0)
        target_tokens = [101] + target_tokens + [102]
        lambda_index_mask = [0] + lambda_index_mask + [0]
        var_index_mask_no = [0] + var_index_mask_no + [0]
        app_index_mask = [0] + app_index_mask + [0]

        # print("insnide", TOKENIZER.convert_ids_to_tokens([101 if t <0 else t for t in target_tokens]))
        
        return sent_embs, target_embs if not self.last else target_embs_last, target_tokens, lambda_index_mask, var_index_mask_no, app_index_mask

def shuffled_collate(batch):
    sent_embedding, lambda_term_embedding, lambda_term_tokens, lambda_mask, var_mask, app_mask = zip(*batch)
    
    sent_embedding, lambda_term_embedding, lambda_term_tokens, lambda_mask, var_mask, app_mask = [sent.squeeze(0) for sent in sent_embedding], [lambda_term.squeeze(0) for lambda_term in lambda_term_embedding], [torch.tensor(sent, dtype=torch.int64) for sent in lambda_term_tokens],[torch.tensor(sent, dtype=torch.bool).squeeze(0) for sent in lambda_mask], [torch.tensor(var, dtype=torch.bool).squeeze(0) for var in var_mask], [torch.tensor(app, dtype=torch.bool).squeeze(0) for app in app_mask]
    sent_embedding_batched = pad_sequence(sent_embedding, batch_first=True, padding_value = 15)
    
    lambda_term_embedding_batched = pad_sequence(lambda_term_embedding, batch_first=True, padding_value = 15)
    lambda_term_tokens_batched = pad_sequence(lambda_term_tokens, batch_first=True, padding_value = 0)
    var_mask_batched = pad_sequence(var_mask, batch_first=True, padding_value = 0)
    lambda_mask_batched = pad_sequence(lambda_mask, batch_first=True, padding_value = 0)
    app_mask_batched = pad_sequence(app_mask, batch_first=True, padding_value = 0)

    lambda_pad_mask = lambda_term_embedding_batched == 15
    lambda_term_embedding_batched = lambda_term_embedding_batched.masked_fill(lambda_pad_mask, 0)
    lambda_pad_mask = lambda_pad_mask.sum(-1) >= 1

    sent_pad_mask = sent_embedding_batched == 15
    sent_embedding_batched = sent_embedding_batched.masked_fill(sent_pad_mask, 0)
    # sent_pad_mask = sent_embedding_batched.sum(-1) >= 1
    return sent_embedding_batched, lambda_term_embedding_batched, lambda_term_tokens_batched, var_mask_batched, lambda_mask_batched, app_mask_batched, lambda_pad_mask, sent_pad_mask


def data_init(batch_size, mode=0, last=False):
    
    #load in the tokenizer
    # tokenizer = BertTokenizer.from_pretrained("bert-base-uncased")
    dataset = ShuffledLambdaTermsDataset(DATA_PATH + 'input_sentences.csv', DATA_PATH + 'lambda_terms/', last=last)
    #split the datset 70 20 10 split
    train_size = int(0.7 * len(dataset))
    val_size = int(0.2 * len(dataset))
    test_size = len(dataset) - train_size - val_size
    
    if mode == 2:
        train_dataset, val_dataset, test_dataset = torch.utils.data.random_split(dataset, [train_size, val_size, test_size])
        train_dataloader = DataLoader(train_dataset, batch_size=batch_size, shuffle=True, num_workers=12, collate_fn=shuffled_collate)
        val_dataloader = DataLoader(val_dataset, batch_size=batch_size, shuffle=False, num_workers=12, collate_fn=shuffled_collate)
        test_dataloader = DataLoader(test_dataset, batch_size=batch_size, shuffle=True, num_workers=12, collate_fn=shuffled_collate)
        return train_dataloader, val_dataloader, test_dataloader
    elif mode == 0:
        train_size += test_size

        train_dataset, val_dataset = torch.utils.data.random_split(dataset, [train_size, val_size])

        train_dataloader = DataLoader(train_dataset, batch_size=batch_size, shuffle=True, num_workers=9, collate_fn=shuffled_collate)
        val_dataloader = DataLoader(val_dataset, batch_size=batch_size, shuffle=False, num_workers=9, collate_fn=shuffled_collate)

        return train_dataloader, val_dataloader
    else:
        #just one dataloader
        train_dataloader = DataLoader(dataset, batch_size=batch_size, shuffle=True, num_workers=9, collate_fn=shuffled_collate)
        return train_dataloader



            
